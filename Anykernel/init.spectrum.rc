# SPECTRUM KERNEL MANAGER
# Ramdisk file for profile based kernel management
# Implimentation inspired by Franco's fku profiles

# Initialization
on property:sys.boot_completed=1
    # Set default profile on first boot
    exec u:r:init:s0 root root -- /init.spectrum.sh
    exec u:r:su:s0 root root -- /init.spectrum.sh
    # Enable Spectrum support
    setprop spectrum.support 1
    # Add kernel name
    setprop ro.m-kernel.version v3.7
    setprop persist.spectrum.kernel M-Kernel

# According to Qcom this legacy value improves first launch latencies
# Stock value is 512k
    setprop dalvik.vm.heapminfree 2m

# Disable some wakelocks
    write /sys/module/wakeup/parameters/enable_wlan_rx_wake_ws 0
    write /sys/module/wakeup/parameters/enable_wlan_ctrl_wake_ws 0
    write /sys/module/wakeup/parameters/enable_wlan_wake_ws 0
    write /sys/module/wakeup/parameters/enable_msm_hsic_ws 0
    write /sys/module/wakeup/parameters/enable_qcom_rx_wakelock_ws 0
    write /sys/module/wakeup/parameters/enable_netlink_ws 0
    write /sys/module/wakeup/parameters/enable_ipa_ws 0
    write /sys/module/wakeup/parameters/enable_timerfd_ws 0

# Interactive governor
    write /sys/devices/system/cpu/cpufreq/interactive/go_hispeed_load 95
    write /sys/devices/system/cpu/cpufreq/interactive/above_hispeed_delay "20000 806400:50000 1036800:50000 1401600:50000"
    write /sys/devices/system/cpu/cpufreq/interactive/timer_rate 80000
    write /sys/devices/system/cpu/cpufreq/interactive/hispeed_freq 1036800
    write /sys/devices/system/cpu/cpufreq/interactive/timer_slack 30000
    write /sys/devices/system/cpu/cpufreq/interactive/target_loads "40 400457:20 652800:30 806400:38 1036800:45 1209600:52 1401600:60 1689600:67 1804800:72 1958400:79 2016000:85 2150400:91 2208000:95"
    write /sys/devices/system/cpu/cpufreq/interactive/min_sample_time 50000
    write /sys/devices/system/cpu/cpufreq/interactive/ignore_hispeed_on_notif 0
    write /sys/devices/system/cpu/cpufreq/interactive/boost 0
    write /sys/devices/system/cpu/cpufreq/interactive/align_windows 1
    write /sys/devices/system/cpu/cpufreq/interactive/use_migration_notif 1
    write /sys/devices/system/cpu/cpufreq/interactive/use_sched_load 0
    write /sys/devices/system/cpu/cpufreq/interactive/max_freq_hysteresis 0
    write /sys/devices/system/cpu/cpufreq/interactive/boostpulse_duration 0

# Disable Touchboost
    write /sys/module/msm_performance/parameters/touchboost 0

# Min/Max backlight values
    write /sys/module/mdss_fb/parameters/backlight_min 0
    write /sys/module/mdss_fb/parameters/backlight_max 255

# Balance (default profile)
on property:persist.spectrum.profile=0
    write /sys/module/autosmp/parameters/enabled 0
    sleep 3
    write /sys/module/autosmp/parameters/enabled 1
    write /sys/class/leds/lcd-backlight/max_brightness 255
    write /sys/kernel/autosmp/conf/cycle_down 1

# Performance
on property:persist.spectrum.profile=1
    write /sys/module/autosmp/parameters/enabled 0
    sleep 3
    write /sys/module/autosmp/parameters/enabled 1
    write /sys/class/leds/lcd-backlight/max_brightness 255
    write /sys/kernel/autosmp/conf/cycle_down 2

# Battery
on property:persist.spectrum.profile=2
    write /sys/module/autosmp/parameters/enabled 0
    sleep 3
    write /sys/module/autosmp/parameters/enabled 1
    write /sys/class/leds/lcd-backlight/max_brightness 100
    write /sys/kernel/autosmp/conf/cycle_down 1

# Gaming
on property:persist.spectrum.profile=3
    write /sys/module/autosmp/parameters/enabled 0
    sleep 3
    write /sys/module/autosmp/parameters/enabled 1
    write /sys/class/leds/lcd-backlight/max_brightness 255
    write /sys/kernel/autosmp/conf/cycle_down 2

